services:
  # Few helper methods combined together to follow OOP paradygm.
  webserver_auth_helper:
    class: Drupal\webserver_auth\WebserverAuthHelper
    arguments: ['@database']

  # Checking if users are logged in properly when session exists.
  webserver_auth.authentication.webserver_auth:
    class: Drupal\webserver_auth\Authentication\Provider\WebserverAuth
    arguments: ['@session_configuration', '@database', '@webserver_auth_helper']

    # We need this to be more prioritized than deault cookie provider since we don't need
    # cookie provider while this module enabled.
    tags:
      - { name: authentication_provider, provider_id: 'webserver_auth', priority: 1, global: TRUE }

  # @todo add description
  webserver_auth.middleware:
    class: Drupal\webserver_auth\StackMiddleware\WebserverAuthMiddleware
    arguments: ['@session_configuration', '@webserver_auth_helper', '@module_handler']

    # We need this to run before page_cache module middleware to be able to prevent.
    tags:
      - { name: http_middleware, priority: 201 }

